// Dados da aplicaÃ§Ã£o
const appData = {
  "fundamentos": [
    {
      "titulo": "Trabalho como PrincÃ­pio Educativo",
      "definicao": "O trabalho Ã© visto como eixo central da educaÃ§Ã£o, unindo teoria e prÃ¡tica na formaÃ§Ã£o humana.",
      "caracteristicas": ["UniÃ£o entre teoria e prÃ¡tica", "Trabalho socialmente necessÃ¡rio", "SuperaÃ§Ã£o da dicotomia manual/intelectual", "FormaÃ§Ã£o atravÃ©s da produÃ§Ã£o"]
    },
    {
      "titulo": "FormaÃ§Ã£o Omnilateral", 
      "definicao": "Desenvolvimento integral do ser humano em todas as suas dimensÃµes: fÃ­sica, intelectual, estÃ©tica e moral.",
      "caracteristicas": ["Desenvolvimento integral", "MÃºltiplas dimensÃµes humanas", "SuperaÃ§Ã£o da fragmentaÃ§Ã£o", "FormaÃ§Ã£o completa da personalidade"]
    },
    {
      "titulo": "Politecnia",
      "definicao": "DomÃ­nio dos fundamentos cientÃ­ficos e tÃ©cnicos dos principais ramos da produÃ§Ã£o moderna.",
      "caracteristicas": ["Base cientÃ­fica da produÃ§Ã£o", "MÃºltiplas especialidades tÃ©cnicas", "CompreensÃ£o do processo produtivo", "Versatilidade profissional"]
    },
    {
      "titulo": "Auto-organizaÃ§Ã£o",
      "definicao": "ParticipaÃ§Ã£o ativa dos estudantes na gestÃ£o e organizaÃ§Ã£o da vida escolar e do processo educativo.",
      "caracteristicas": ["GestÃ£o democrÃ¡tica", "ParticipaÃ§Ã£o estudantil", "AutodireÃ§Ã£o", "Desenvolvimento da autonomia"]
    }
  ],
  "teoricos": [
    {
      "nome": "Karl Marx",
      "periodo": "1818-1883", 
      "contribuicoes": "Fundamentos teÃ³ricos da educaÃ§Ã£o socialista. UniÃ£o ensino-trabalho. EducaÃ§Ã£o politÃ©cnica.",
      "conceitos": "Politecnia, Omnilateralidade, Trabalho como princÃ­pio educativo"
    },
    {
      "nome": "Friedrich Engels",
      "periodo": "1820-1895",
      "contribuicoes": "EducaÃ§Ã£o para o trabalho produtivo desde os 9 anos. FormaÃ§Ã£o integral.",
      "conceitos": "InstruÃ§Ã£o integral, EducaÃ§Ã£o produtiva, Trabalho manual e intelectual"
    },
    {
      "nome": "Nadejda Krupskaya", 
      "periodo": "1869-1939",
      "contribuicoes": "Escola do trabalho vs escola livresca. Auto-organizaÃ§Ã£o estudantil. EducaÃ§Ã£o para a democracia.",
      "conceitos": "Escola livre, Auto-organizaÃ§Ã£o, EducaÃ§Ã£o nÃ£o-sexista"
    },
    {
      "nome": "Moisey Pistrak",
      "periodo": "1888-1937",
      "contribuicoes": "Sistema de complexos temÃ¡ticos. Escola como centro cultural da comunidade.",
      "conceitos": "Complexos temÃ¡ticos, Atualidade, Auto-direÃ§Ã£o"
    },
    {
      "nome": "Anton Makarenko",
      "periodo": "1888-1939", 
      "contribuicoes": "Pedagogia do coletivo. FormaÃ§Ã£o do 'homem novo' socialista.",
      "conceitos": "Coletividade, Disciplina consciente, Personalidade socialista"
    },
    {
      "nome": "Antonio Gramsci",
      "periodo": "1891-1937", 
      "contribuicoes": "Escola UnitÃ¡ria. Defesa da importÃ¢ncia da cultura popular na formaÃ§Ã£o de sujeitos politizados.",
      "conceitos": "Cultura Popular, PrÃ¡xis, Hegemonia"
    },
    {
      "nome": "Paulo Freire",
      "periodo": "1921-1997",
      "contribuicoes": "Pedagogia crÃ­tica e libertadora. EducaÃ§Ã£o como prÃ¡tica da liberdade.",
      "conceitos": "ConscientizaÃ§Ã£o, PrÃ¡xis, EducaÃ§Ã£o problematizadora"
    },
    {
      "nome": "Dermeval Saviani",
      "periodo": "1943-atual",
      "contribuicoes": "Pedagogia histÃ³rico-crÃ­tica. SocializaÃ§Ã£o do saber sistematizado.",
      "conceitos": "PrÃ¡tica social, InstrumentalizaÃ§Ã£o, Catarse"
    }
  ],
  "marcos_historicos": [
    {
      "ano": 1848,
      "evento": "Manifesto Comunista",
      "descricao": "Marx e Engels estabelecem os primeiros fundamentos da educaÃ§Ã£o socialista"
    },
    {
      "ano": 1917,
      "evento": "RevoluÃ§Ã£o Russa", 
      "descricao": "Contexto histÃ³rico que possibilitou a primeira experiÃªncia educacional socialista em larga escala"
    },
    {
      "ano": 1918,
      "evento": "Escola Ãšnica do Trabalho",
      "descricao": "CriaÃ§Ã£o da primeira experiÃªncia sistemÃ¡tica de educaÃ§Ã£o socialista na URSS"
    },
    {
      "ano": 1928,
      "evento": "Fundamentos da Escola do Trabalho",
      "descricao": "Pistrak publica a principal obra sobre a pedagogia socialista soviÃ©tica"
    },
    {
      "ano": 1970,
      "evento": "Pedagogia do Oprimido",
      "descricao": "Paulo Freire publica sua principal obra sobre educaÃ§Ã£o crÃ­tica"
    },
    {
      "ano": 1983,
      "evento": "Pedagogia HistÃ³rico-CrÃ­tica",
      "descricao": "Saviani desenvolve a pedagogia socialista brasileira"
    },
    {
      "ano": 1990,
      "evento": "MST e EducaÃ§Ã£o do Campo",
      "descricao": "Movimento Sem Terra adota princÃ­pios da pedagogia socialista"
    }
  ],
  "quiz": [
    {
      "pergunta": "Qual Ã© o princÃ­pio central da pedagogia socialista?",
      "opcoes": ["MemorizaÃ§Ã£o", "Trabalho como princÃ­pio educativo", "CompetiÃ§Ã£o", "Individualismo"],
      "resposta_correta": 1
    },
    {
      "pergunta": "Quem criou o Sistema de Complexos TemÃ¡ticos?",
      "opcoes": ["Marx", "Freire", "Pistrak", "Makarenko"], 
      "resposta_correta": 2
    },
    {
      "pergunta": "O que significa formaÃ§Ã£o omnilateral?",
      "opcoes": ["EspecializaÃ§Ã£o precoce", "Desenvolvimento integral", "FormaÃ§Ã£o tÃ©cnica", "EducaÃ§Ã£o elitista"],
      "resposta_correta": 1
    },
    {
      "pergunta": "A Escola Ãšnica do Trabalho foi criada em qual contexto?",
      "opcoes": ["RevoluÃ§Ã£o Francesa", "RevoluÃ§Ã£o Industrial", "RevoluÃ§Ã£o Russa", "RevoluÃ§Ã£o Cubana"],
      "resposta_correta": 2
    }
  ]
};

// Estado da aplicaÃ§Ã£o
let currentQuestionIndex = 0;
let quizScore = 0;
let selectedAnswer = null;

// Elementos DOM
const navLinks = document.querySelectorAll('.nav-link');
const sections = document.querySelectorAll('.section');
const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
const navMenu = document.querySelector('.nav-menu');

// InicializaÃ§Ã£o
document.addEventListener('DOMContentLoaded', function() {
  initializeNavigation();
  initializeFundamentos();
  initializeTeoricos();
  initializeTimeline();
  initializeSearch();
  initializeQuiz();
  initializeModals();
  initializeMobileMenu();
});

// NavegaÃ§Ã£o
function initializeNavigation() {
  // NavegaÃ§Ã£o por links do menu
  navLinks.forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const targetSection = link.getAttribute('data-section');
      showSection(targetSection);
      updateActiveNavLink(link);
    });
  });

  // BotÃµes de navegaÃ§Ã£o da hero
  const navigateButtons = document.querySelectorAll('.btn-navigate');
  navigateButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const target = btn.getAttribute('data-target');
      showSection(target);
      updateActiveNavLink(document.querySelector(`[data-section="${target}"]`));
    });
  });
}

function showSection(sectionId) {
  sections.forEach(section => {
    section.classList.remove('active');
  });
  
  const targetSection = document.getElementById(sectionId);
  if (targetSection) {
    targetSection.classList.add('active');
  }
}

function updateActiveNavLink(activeLink) {
  navLinks.forEach(link => {
    link.classList.remove('active');
  });
  activeLink.classList.add('active');
}

// Menu Mobile
function initializeMobileMenu() {
  mobileMenuToggle.addEventListener('click', () => {
    navMenu.classList.toggle('active');
  });
}

// Fundamentos
function initializeFundamentos() {
  const expandButtons = document.querySelectorAll('.expand-btn');
  
  expandButtons.forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const card = btn.closest('.fundamento-card');
      const fundamentoType = card.getAttribute('data-fundamento');
      showFundamentoModal(fundamentoType);
    });
  });

  // TambÃ©m permite clicar no card inteiro
  const fundamentoCards = document.querySelectorAll('.fundamento-card');
  fundamentoCards.forEach(card => {
    card.addEventListener('click', () => {
      const fundamentoType = card.getAttribute('data-fundamento');
      showFundamentoModal(fundamentoType);
    });
  });
}

function showFundamentoModal(type) {
  const fundamentoMap = {
    'trabalho': 0,
    'omnilateral': 1,
    'politecnia': 2,
    'autoorganizacao': 3
  };
  
  const fundamento = appData.fundamentos[fundamentoMap[type]];
  if (!fundamento) return;

  const modal = document.getElementById('fundamento-modal');
  const title = document.getElementById('modal-title');
  const definition = document.getElementById('modal-definition');
  const characteristics = document.getElementById('modal-characteristics');

  title.textContent = fundamento.titulo;
  definition.textContent = fundamento.definicao;
  
  characteristics.innerHTML = '';
  fundamento.caracteristicas.forEach(char => {
    const li = document.createElement('li');
    li.textContent = char;
    characteristics.appendChild(li);
  });

  modal.style.display = 'block';
}

// TeÃ³ricos
function initializeTeoricos() {
  const teoricoCards = document.querySelectorAll('.teorico-card');
  
  teoricoCards.forEach(card => {
    const btn = card.querySelector('.btn');
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const teoricoType = card.getAttribute('data-teorico');
      showTeoricoModal(teoricoType);
    });
  });
}

function showTeoricoModal(type) {
  const teoricoMap = {
    'marx': 0,
    'engels': 1,
    'krupskaya': 2,
    'pistrak': 3,
    'makarenko': 4,
    'gramsci': 5,
    'freire': 6,
    'saviani': 7
  };
  
  const teorico = appData.teoricos[teoricoMap[type]];
  if (!teorico) return;

  const modal = document.getElementById('teorico-modal');
  const title = document.getElementById('teorico-modal-title');
  const periodo = document.getElementById('teorico-modal-periodo');
  const contribuicoes = document.getElementById('teorico-modal-contribuicoes');
  const conceitos = document.getElementById('teorico-modal-conceitos');

  title.textContent = teorico.nome;
  periodo.textContent = `PerÃ­odo: ${teorico.periodo}`;
  contribuicoes.textContent = teorico.contribuicoes;
  conceitos.textContent = teorico.conceitos;

  modal.style.display = 'block';
}

// Timeline
function initializeTimeline() {
  const timelineItems = document.querySelectorAll('.timeline-item');
  
  timelineItems.forEach(item => {
    item.addEventListener('click', () => {
      const ano = parseInt(item.getAttribute('data-ano'));
      showTimelineModal(ano);
    });
  });
}

function showTimelineModal(ano) {
  const marco = appData.marcos_historicos.find(m => m.ano === ano);
  if (!marco) return;

  const modal = document.getElementById('timeline-modal');
  const title = document.getElementById('timeline-modal-title');
  const descricao = document.getElementById('timeline-modal-descricao');

  title.textContent = `${marco.ano} - ${marco.evento}`;
  descricao.textContent = marco.descricao;

  modal.style.display = 'block';
}

// Sistema de busca
function initializeSearch() {
  const searchInput = document.getElementById('search-input');
  const conceitoItems = document.querySelectorAll('.conceito-item');

  searchInput.addEventListener('input', (e) => {
    const searchTerm = e.target.value.toLowerCase();
    
    conceitoItems.forEach(item => {
      const title = item.querySelector('h3').textContent.toLowerCase();
      const content = item.querySelector('p').textContent.toLowerCase();
      
      if (title.includes(searchTerm) || content.includes(searchTerm)) {
        item.classList.remove('hidden');
      } else {
        item.classList.add('hidden');
      }
    });
  });
}

// Quiz
function initializeQuiz() {
  resetQuiz();
  loadQuestion();
  
  document.getElementById('next-btn').addEventListener('click', nextQuestion);
  document.getElementById('restart-btn').addEventListener('click', resetQuiz);
}

function loadQuestion() {
  if (currentQuestionIndex >= appData.quiz.length) {
    showQuizResults();
    return;
  }

  const question = appData.quiz[currentQuestionIndex];
  const questionText = document.getElementById('question-text');
  const optionsContainer = document.getElementById('options-container');
  const feedback = document.getElementById('quiz-feedback');
  const nextBtn = document.getElementById('next-btn');

  // Atualizar progresso
  updateQuizProgress();

  // Limpar estado anterior
  feedback.style.display = 'none';
  nextBtn.style.display = 'none';
  selectedAnswer = null;

  // Carregar pergunta
  questionText.textContent = question.pergunta;
  
  // Carregar opÃ§Ãµes
  optionsContainer.innerHTML = '';
  question.opcoes.forEach((opcao, index) => {
    const button = document.createElement('button');
    button.className = 'option-btn';
    button.textContent = opcao;
    button.addEventListener('click', () => selectAnswer(index, button));
    optionsContainer.appendChild(button);
  });
}

function selectAnswer(answerIndex, buttonElement) {
  // Remover seleÃ§Ã£o anterior
  document.querySelectorAll('.option-btn').forEach(btn => {
    btn.classList.remove('selected');
  });

  // Marcar nova seleÃ§Ã£o
  buttonElement.classList.add('selected');
  selectedAnswer = answerIndex;

  // Verificar resposta
  checkAnswer();
}

function checkAnswer() {
  if (selectedAnswer === null) return;

  const question = appData.quiz[currentQuestionIndex];
  const isCorrect = selectedAnswer === question.resposta_correta;
  const feedback = document.getElementById('quiz-feedback');
  const nextBtn = document.getElementById('next-btn');
  const options = document.querySelectorAll('.option-btn');

  // Desabilitar todas as opÃ§Ãµes
  options.forEach((option, index) => {
    option.disabled = true;
    if (index === question.resposta_correta) {
      option.classList.add('correct');
    } else if (index === selectedAnswer && !isCorrect) {
      option.classList.add('incorrect');
    }
  });

  // Mostrar feedback
  feedback.style.display = 'block';
  if (isCorrect) {
    feedback.className = 'quiz-feedback correct';
    feedback.textContent = 'âœ“ Resposta correta! Muito bem!';
    quizScore++;
    updateScore();
  } else {
    feedback.className = 'quiz-feedback incorrect';
    feedback.textContent = 'âœ— Resposta incorreta. A resposta correta Ã©: ' + question.opcoes[question.resposta_correta];
  }

  // Mostrar botÃ£o prÃ³xima
  nextBtn.style.display = 'block';
}

function nextQuestion() {
  currentQuestionIndex++;
  loadQuestion();
}

function updateQuizProgress() {
  const currentQuestionSpan = document.getElementById('current-question');
  const totalQuestionsSpan = document.getElementById('total-questions');
  const progressFill = document.getElementById('progress-fill');

  currentQuestionSpan.textContent = currentQuestionIndex + 1;
  totalQuestionsSpan.textContent = appData.quiz.length;
  
  const progress = ((currentQuestionIndex + 1) / appData.quiz.length) * 100;
  progressFill.style.width = progress + '%';
}

function updateScore() {
  const scoreSpan = document.getElementById('score');
  scoreSpan.textContent = quizScore;
}

function showQuizResults() {
  const questionText = document.getElementById('question-text');
  const optionsContainer = document.getElementById('options-container');
  const feedback = document.getElementById('quiz-feedback');
  const nextBtn = document.getElementById('next-btn');
  const restartBtn = document.getElementById('restart-btn');

  questionText.textContent = 'Quiz Finalizado!';
  optionsContainer.innerHTML = '';
  
  const percentage = Math.round((quizScore / appData.quiz.length) * 100);
  let message = '';
  
  if (percentage >= 80) {
    message = 'ğŸ‰ Excelente! VocÃª demonstra um Ã³timo domÃ­nio dos conceitos da pedagogia socialista!';
  } else if (percentage >= 60) {
    message = 'ğŸ‘ Bom trabalho! VocÃª tem uma base sÃ³lida, mas pode aprofundar alguns conceitos.';
  } else {
    message = 'ğŸ“š Continue estudando! Revise os materiais para fortalecer seu conhecimento.';
  }

  feedback.style.display = 'block';
  feedback.className = 'quiz-feedback';
  feedback.innerHTML = `
    <h4>Resultado Final</h4>
    <p><strong>PontuaÃ§Ã£o: ${quizScore} de ${appData.quiz.length} (${percentage}%)</strong></p>
    <p>${message}</p>
  `;

  nextBtn.style.display = 'none';
  restartBtn.style.display = 'block';
}

function resetQuiz() {
  currentQuestionIndex = 0;
  quizScore = 0;
  selectedAnswer = null;
  updateScore();
  
  const restartBtn = document.getElementById('restart-btn');
  restartBtn.style.display = 'none';
  
  loadQuestion();
}

// Modais
function initializeModals() {
  const modals = document.querySelectorAll('.modal');
  const closeButtons = document.querySelectorAll('.close');

  // Fechar modal ao clicar no X
  closeButtons.forEach(closeBtn => {
    closeBtn.addEventListener('click', () => {
      modals.forEach(modal => {
        modal.style.display = 'none';
      });
    });
  });

  // Fechar modal ao clicar fora
  modals.forEach(modal => {
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });
  });

  // Fechar modal com ESC
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      modals.forEach(modal => {
        modal.style.display = 'none';
      });
    }
  });
}

// UtilitÃ¡rios
function smoothScrollTo(element) {
  element.scrollIntoView({
    behavior: 'smooth',
    block: 'start'
  });
}